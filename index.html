<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Pretendard", "Noto Sans KR", system-ui, sans-serif;
      background: #f5f5f5;
    }
    .message {
      text-align: center;
      padding: 40px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #c8d0e0;
      border-top-color: #2563eb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    h2 { margin: 0 0 8px; color: #1f2937; }
    p { margin: 0; color: #6b7280; }
  </style>
</head>
<body>
  <div class="message" id="message">
    <div class="spinner"></div>
    <h2>처리 중...</h2>
    <p>잠시만 기다려 주세요.</p>
  </div>

  <script>
    // 단순 라우터: URL 파라미터에 따라 적절한 페이지로 리다이렉트
    const init = () => {
      const url = new URL(window.location.href);
      const type = url.searchParams.get("type");
      const tokenHash = url.searchParams.get("token_hash");

      // 1. token_hash + type 방식 (이메일 템플릿에서 직접 전달)
      if (tokenHash && type === "recovery") {
        window.location.href = `/auth-complete-page/reset-password.html?token_hash=${encodeURIComponent(tokenHash)}&type=recovery`;
        return;
      }
      if (tokenHash && type === "signup") {
        window.location.href = `/auth-complete-page/signup-complete.html?token_hash=${encodeURIComponent(tokenHash)}&type=signup`;
        return;
      }

      // 2. type만 있는 경우 (fallback)
      if (type === "signup") {
        window.location.href = "/auth-complete-page/signup-complete.html";
        return;
      }
      if (type === "recovery") {
        window.location.href = "/auth-complete-page/reset-password.html";
        return;
      }

      // 3. 해시 프래그먼트 확인: #access_token=...&type=recovery
      const hash = window.location.hash;
      if (hash) {
        const hashParams = new URLSearchParams(hash.replace('#', ''));
        const hashType = hashParams.get('type');
        
        if (hashType === 'recovery') {
          window.location.href = `/auth-complete-page/reset-password.html${hash}`;
          return;
        }
        if (hashType === 'signup') {
          window.location.href = `/auth-complete-page/signup-complete.html${hash}`;
          return;
        }
      }

      // 4. 유효하지 않은 요청
      document.getElementById('message').innerHTML = `
        <h2 style="color:#ef4444;">유효하지 않은 요청입니다.</h2>
        <p>링크가 잘못되었거나 만료되었습니다.</p>
      `;
    };

    init();
  </script>
</body>
</html>
